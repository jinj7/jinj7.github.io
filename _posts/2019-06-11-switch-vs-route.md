---
layout: post
title: Switch vs Route
categories: [network]
keywords: switch route
---

# Switch (交换)
 一般指的是同网段内分组包的转发，转发依据：MAC地址。

## PC视角
当两台主机在同一个网段，PC1需要访问PC2时，PC1首先会发送arp请求报文，请求PC2的的MAC地址；收到响应后，PC1会把PC2的MAC地址封装在分组包的目的MAC的位置，然后将分组报文扔给交换机；PC2也会做类似的动作。

## 交换机视角
交换机会接收网段上的所有数据帧；利用接收数据帧中的源MAC地址来建立MAC地址表（源地址自学习），使用地址老化机制进行地址表维护。MAC地址表中查找数据帧中的目的MAC地址，如果找到就将该数据帧发送到相应的端口，如果找不到，就向除入端口以外的所有的端口发送；向所有端口转发广播帧和多播帧。

# Route (路由)
一般指不同网段的数据包的转发，转发依据：IP路由。

## PC视角
当两台主机在不同的网段，PC1需要访问PC2时，PC1首先会在自己的路由表内查询PC2的IP地址对应的下一跳（一般默认是网关）地址，然后再去发送ARP报文，请求该下一跳对应的MAC地址；收到响应后，PC1会把该MAC地址封装在数据包的目的MAC的位置（注意此时的目的IP仍是PC2的IP地址，而不是下一跳IP），然后将数据报文扔给路由器；PC2也会做类似的动作。

## 交换机视角
当路由器收到一个IP数据包，路由器就会找出数据包的三层包头中的目的IP地址，然后拿着目的IP地址到自己的路由表中进行查询，找到“最匹配”的路由条目后，将数据包根据路由条目所指示的出接口或者下一跳IP转发出去，这就是IP路由（当然路由器还会做一些额外的工作：将数据包的三层包头的TTL减一，修改数据包的二层源MAC地址为自己出接口的MAC，修改数据包的二层目的MAC地址为下一跳的MAC）；而每一台路由器都会在本地维护一个路由表（Routing Table），路由表中装在着路由器获知的路由条目，路由条目由路由前缀（路由所关联的目的地址）、路由信息的来源、出接口或者下一跳IP等元素构成；路由器通过静态配置或者动态的方式获取路由条目并维护自己的路由表。

